<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="传输层协议简介"><meta name="keywords" content="计算机网络"><meta name="author" content="woyao"><meta name="copyright" content="woyao"><title>传输层协议简介 | woyao的博客</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '5.4.0'
} </script><meta name="generator" content="Hexo 5.4.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#tcp%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.</span> <span class="toc-text">tcp协议</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#upd%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.</span> <span class="toc-text">upd协议</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tcp%E4%B8%8Eudp%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">3.</span> <span class="toc-text">tcp与udp的区别</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#tcp%E7%9A%84%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6"><span class="toc-number">3.1.</span> <span class="toc-text">tcp的流量控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tcp%E7%9A%84%E9%98%BB%E5%A1%9E%E6%8E%A7%E5%88%B6"><span class="toc-number">3.2.</span> <span class="toc-text">tcp的阻塞控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%85%A2%E5%90%AF%E5%8A%A8"><span class="toc-number">3.2.1.</span> <span class="toc-text">慢启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BB%E5%A1%9E%E9%81%BF%E5%85%8D"><span class="toc-number">3.2.2.</span> <span class="toc-text">阻塞避免</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E9%87%8D%E4%BC%A0"><span class="toc-number">3.2.3.</span> <span class="toc-text">快重传</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E6%81%A2%E5%A4%8D"><span class="toc-number">3.2.4.</span> <span class="toc-text">快恢复</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E8%BF%9E%E6%8E%A5%E7%9A%84-tcp%E7%9A%84%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%EF%BC%89"><span class="toc-number">3.3.</span> <span class="toc-text">面向连接的(tcp的三次握手）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B"><span class="toc-number">3.4.</span> <span class="toc-text">四次挥手</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5%E5%8D%8F%E8%AE%AE%E6%98%AF%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%EF%BC%8C%E8%80%8C%E5%85%B3%E9%97%AD%E8%BF%9E%E6%8E%A5%E5%8D%B4%E6%98%AF%E5%9B%9B%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%91%A2%EF%BC%9F"><span class="toc-number">3.5.</span> <span class="toc-text">为什么建立连接协议是三次握手，而关闭连接却是四次握手呢？</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="http://0.gravatar.com/avatar/0e261cd9b93afcd1c13b39d5ba7d6e2d"></div><div class="author-info__name text-center">woyao</div><div class="author-info__description text-center">分享，交流，学习，成长</div><div class="follow-button"><a target="_blank" rel="noopener" href="https://github.com/ChenWoyao">follow me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">61</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">12</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">8</span></a></div></div></div><div id="content-outer"><div class="plain" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">woyao的博客</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/categories">目录</a><a class="site-page" href="/archives">文章总览</a><a class="site-page" href="/projects">项目实战</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/about">关于作者</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div></div><div class="layout" id="content-inner"><article id="post"><div class="plain" id="post-title">传输层协议简介</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-04-23</time><span class="post-meta__separator">|</span><i class="fa fa-inbox" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"> 计算机网络</a><span class="post-meta__separator">|</span><span class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">1.8k</span><span class="post-meta__separator">|</span><span>阅读时长: 5 分钟</span></span></div><div class="article-container" id="post-content"><h1 id="tcp协议"><a href="#tcp协议" class="headerlink" title="tcp协议"></a>tcp协议</h1><p>该协议的作用是保证数据通信的完整性和可靠性，防止丢包。<br>特点如下:<br><strong>面向连接的</strong>、<strong>可靠的</strong>、<strong>面向字节流的</strong>、<strong>有流量控制</strong>、<strong>阻塞控制</strong>、<strong>负载较高</strong></p>
<h1 id="upd协议"><a href="#upd协议" class="headerlink" title="upd协议"></a>upd协议</h1><p><strong>面向无连接的</strong>、<strong>不可靠的</strong>、<strong>面向数据报的</strong>、<strong>无流量控制</strong>、<strong>无阻塞控制</strong>、<strong>负载相对较低</strong></p>
<h1 id="tcp与udp的区别"><a href="#tcp与udp的区别" class="headerlink" title="tcp与udp的区别"></a>tcp与udp的区别</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">（1）TCP协议在传送数据段的时候要给段标号；UDP协议不</span><br><span class="line">（2）TCP协议可靠；UDP协议不可靠</span><br><span class="line">（3）TCP协议是面向连接；UDP协议采用无连接</span><br><span class="line">（4）TCP协议负载较高，采用虚电路；UDP采用无连接</span><br><span class="line">（5）TCP协议的发送方要确认接收方是否收到数据段（3次握手协议）</span><br><span class="line">（6）TCP协议采用窗口技术和流控制</span><br></pre></td></tr></table></figure>
<h2 id="tcp的流量控制"><a href="#tcp的流量控制" class="headerlink" title="tcp的流量控制"></a>tcp的流量控制</h2><p>为了提高信道的利用率TCP协议不使用停止等待协议，而是使用滑动窗口协议(连续ARQ协议)<br>意思就是可以连续发出若干个分组然后等待确认,而不是发送一个分组就停止并等待该分组的确认。<br>而所谓流量控制就是让发送端发送的数据过多或者数据发送速率过快，接收端来不及处理，则会造成数据在接收端的丢弃。<br>利用滑动窗口（零窗口，坚持定时器）机制就可以实施流量控制。<br>关于滑动窗口机制:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">接收端可以用大小为0的窗口(目前不能在接受数据了)通知发送端停止发送数据流。</span><br><span class="line">但是如果下一次窗口不为0的应答在传输过程丢失，发送者一直等待下去</span><br><span class="line">而接收者以为发送者已经收到该应答等待接收新数据，这样双方就相互等待，从而产生死锁。</span><br><span class="line">所以还需要用定时器机制处理，每当发送者收到一个零窗口的应答后就启动该计时器</span><br><span class="line">发送端定时发送探测报文段，接收端应答不为0，就继续定时发送，直到接收端缓存不为空。</span><br></pre></td></tr></table></figure>

<h2 id="tcp的阻塞控制"><a href="#tcp的阻塞控制" class="headerlink" title="tcp的阻塞控制"></a>tcp的阻塞控制</h2><p>为什么会产生TCP的阻塞呢, 其实就是发送端发送的报文速度要比接收端处理数据速率大。<br>TCP对于阻塞控制一共有四种算法，分别是<strong>慢开始</strong>，<strong>阻塞避免</strong>，<strong>快重传</strong>，<strong>快恢复</strong>四种算法。<br>由于需要考虑拥塞控制和流量控制两个方面的内容, 因此TCP的真正的发送窗口=min(rwnd, cwnd)(接受窗口, 拥塞窗口)</p>
<h3 id="慢启动"><a href="#慢启动" class="headerlink" title="慢启动"></a>慢启动</h3><p>怎么知道接收方线路的理想速率是多少呢，需要慢启动慢慢试<br>始的时候，发送得较慢，然后根据丢包的情况调整速率，如果不丢包，就加快发送速度；如果丢包，就降低发送速度。</p>
<h3 id="阻塞避免"><a href="#阻塞避免" class="headerlink" title="阻塞避免"></a>阻塞避免</h3><p>到达阈值以后，加法增加。<br>从慢启动可以看到，cwnd可以很快的增长上来，从而最大程度利用网络带宽资源，<br>但是cwnd不能一直这样无限增长下去，一定需要某个限制。<br>TCP使用了一个叫慢启动门限(ssthresh)的变量，当cwnd超过该值后，慢启动过程结束，进入拥塞避免阶段。<br>拥塞避免的主要思想是加法增大，也就是cwnd的值不再指数级往上升，开始加法增加。<br>此时当窗口中所有的报文段都被确认时，cwnd的大小加1，cwnd的值就随着RTT开始线性增加，<br>这样就可以避免增长过快导致网络拥塞，慢慢的增加调整到网络的最佳值。</p>
<p><img src="http://121.5.231.10:3000/computerNetwork/%E9%98%BB%E5%A1%9E%E6%9C%BA%E5%88%B6.jpg" alt="阻塞避免的图片"></p>
<h3 id="快重传"><a href="#快重传" class="headerlink" title="快重传"></a>快重传</h3><p>收到三次同样的ack以后，立即发送该syn报文，并启用快恢复<br>ack是指：一个确认消息，携带了期待要收到下一个数据包的编号和接收方的接收窗口的剩余容量<br><img src="http://121.5.231.10:3000/computerNetwork/%E5%BF%AB%E9%87%8D%E4%BC%A0.jpg" alt="快重传"></p>
<h3 id="快恢复"><a href="#快恢复" class="headerlink" title="快恢复"></a>快恢复</h3><p>如果发送方设置定时器超时，那么很可能是网络出现了拥塞，<br>致使TCP报文段在网络中的某处被丢弃。在这种情况下<br>开始门限值减半，然后使用阻塞避免的增加法</p>
<h2 id="面向连接的-tcp的三次握手）"><a href="#面向连接的-tcp的三次握手）" class="headerlink" title="面向连接的(tcp的三次握手）"></a>面向连接的(tcp的三次握手）</h2><p>序列号:seq, 确认号:ack, syn:报文<br>客户端发送SYN报文，置发序列号为X<br>服务端发送SYN+ACK报文，并置发序列号为Y，确认序列号X+1<br>客户端发送ACK报文，并置发序列号为Z，确认号Y+1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">第一次握手：建立连接时，客户端A发送SYN包(SYN&#x3D;j)到服务器B，并进入SYN_SEND状态，等待服务器B确认。</span><br><span class="line"></span><br><span class="line">第二次握手：服务器B收到SYN包，必须确认客户A的SYN(ACK&#x3D;j+1)，同时自己也发送一个SYN包(SYN&#x3D;k)，即SYN+ACK包，此时服务器B进入SYN_RECV状态</span><br><span class="line"></span><br><span class="line">第三次握手：客户端A收到服务器B的SYN＋ACK包，向服务器B发送确认包ACK(ACK&#x3D;k+1)，此包发送完毕，客户端A和服务器B进入ESTABLISHED状态，完成三次握手。</span><br></pre></td></tr></table></figure>

<h2 id="四次挥手"><a href="#四次挥手" class="headerlink" title="四次挥手"></a>四次挥手</h2><p>主动发送Fin+Ack报文，并置发序列号为X<br>被发送方发送ACK报文，并只发送序列号为Z，确认号X+1<br>被动方发送Fin+Ack报文，并只发送序列号Y，确认号为X<br>主动发发送ack报文，并只发送序列号X，确认号Y</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">第一次挥手:客户端A发送一个FIN，用来关闭客户A到服务器B的数据传送(报文段4)。[A告诉B我要和你断开连接了]</span><br><span class="line">第二次挥手: 服务器B收到这个FIN，它发回一个ACK，确认序号为收到的序号加1(报文段5)。和SYN一样，一个FIN将占用一个序号。 [B发送发可能还有数据没有发送完给A，把剩余的数据发送出去]</span><br><span class="line">第三次挥手: 与客户端A的连接，发送一个FIN给客户端A(报文段6)。 [B发送方告诉A我要断开和你的连接了]</span><br><span class="line">第四次挥手: CK报文确认，并将确认序号设置为收到序号加1(报文段7)。 [A告诉B我收到了你要和我断开连接的消息]</span><br></pre></td></tr></table></figure>

<h2 id="为什么建立连接协议是三次握手，而关闭连接却是四次握手呢？"><a href="#为什么建立连接协议是三次握手，而关闭连接却是四次握手呢？" class="headerlink" title="为什么建立连接协议是三次握手，而关闭连接却是四次握手呢？"></a>为什么建立连接协议是三次握手，而关闭连接却是四次握手呢？</h2><p>这是因为服务端的LISTEN状态下的SOCKET当收到SYN报文的连接请求后，<br>它可以把ACK和SYN(ACK起应答作用，而SYN起同步作用)放在一个报文里来发送。<br>但关闭连接时，当收到对方的FIN报文通知时，<br><code>它仅仅表示对方没有数据发送给你了；但未必你所有的数据都全部发送给对方了</code><br>所以你可能未必会马上会关闭SOCKET, 以及你可能还需要发送一些数据给对方之后，<br>再发送FIN报文给对方来表示你同意现在可以关闭连接了，<br>所以它这里的ACK报文和FIN报文多数情况下都是分开发送的。</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">woyao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://chenwoyao.github.io/2021/04/23/计算机网络/传输层协议简介/">https://chenwoyao.github.io/2021/04/23/计算机网络/传输层协议简介/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://chenwoyao.github.io">woyao的博客</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></div><div class="addthis_inline_share_toolbox pull-right"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-607541e3279cfc8b" async></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/04/23/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E7%AE%80%E4%BB%8B/"><i class="fa fa-chevron-left">  </i><span>网络安全简介</span></a></div><div class="next-post pull-right"><a href="/2021/04/23/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E5%B1%82%E5%8D%8F%E8%AE%AE%E7%AE%80%E4%BB%8B/"><span>网络层协议简介</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '428a1dc9101af973234b',
  clientSecret: 'c3ee519e5e2db3e4e3c0025a9b332dd76f7c29f2',
  repo: 'ChenWoyao.github.io',
  owner: 'ChenWoyao',
  admin: 'ChenWoyao',
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN'
})
gitalk.render('gitalk-container')</script></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2021 By woyao</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>